# 声乐练习音高曲线

这是一个可直接部署到 GitHub Pages 的静态前端页面，用于实时采集麦克风输入、检测音高并绘制音高曲线。

## 使用方式

1. 打开页面后点击“开始检测”。
2. 浏览器会请求麦克风权限，允许后即可看到实时音高曲线、频率与音名。
3. 点击“停止”结束本次采集。
4. 侧边栏“音高算法”可切换不同的音高检测算法（AMDF / 自相关 / 频域 HPS）。
5. 侧边栏“音高刻度”可选择移动刻度、固定刻度（50–500 Hz）或对数刻度（动态）。
6. 侧边栏“共振峰”开关开启后，会同时显示 F1/F2 数字与对应的曲线。
7. 侧边栏“显示模式”可切换音高曲线与实时频谱图视图。
8. 侧边栏“窗口缩放”可以调节音高窗口占屏幕的大小比例。
9. 在“显示模式”中可选择频谱叠加（音高曲线 / 共振峰曲线），用于在频谱图上同步观察。
10. 侧边栏“显示音量条”可以控制左侧音量刻度条的显示。
11. 录音：点击“开始录音”/“停止录音”后，可在“离线分析”中选择分析最近录音或下载到本地。
12. 伴奏播放：在侧边栏上传伴奏文件后可播放/暂停/停止并调整音量。建议使用耳机减少伴奏被麦克风拾取。

## 保存/导出

- **保存本次（CSV）**：会导出最近 `maxHistorySeconds` 秒内的有效音高点。
  - CSV 列包含 `timestampMs`（相对开始检测的毫秒）、`frequencyHz`（保留 1 位小数）、`note`。
- **导出截图（PNG）**：将当前 canvas 画面保存为 PNG 文件。

以上两个按钮在未开始检测或没有有效音高数据时会置灰。

## 上传音频离线分析

侧边栏提供“上传音频”功能，支持常见音频格式（如 wav/mp3）。流程如下：

1. 点击“上传音频”选择文件，页面会显示“数据源：音频文件”并开始离线分析。
2. 分析过程中会显示进度百分比；完成后可导出 CSV/PNG。
3. 点击“清除文件/返回实时”即可回到实时麦克风模式。

默认最大分析时长为 300 秒（约 5 分钟），超过时会提示是否继续分析全片。若解码失败，请尝试使用 wav/mp3 格式。
